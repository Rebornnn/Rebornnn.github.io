<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">



  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/lib/pace/pace-theme-flash.min.css?v=1.0.2" rel="stylesheet">







<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">




  
  
  
  

  
    
    
  

  
    
      
    

    
  

  

  
    
      
    

    
  

  
    
      
    

    
  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Monda:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|Lobster Two:300,300italic,400,400italic,700,700italic|PT Mono:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.2" rel="stylesheet" type="text/css">


  <meta name="keywords" content="JavaScript,系统学习,">








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.2">






<meta name="description" content="行为委托设计模式的基础是JS中[[Prototype]]机制的本质是对象之间的关联关系。">
<meta name="keywords" content="JavaScript,系统学习">
<meta property="og:type" content="article">
<meta property="og:title" content="《你不知道的JavaScript-上》行为委托">
<meta property="og:url" content="http://yoursite.com/2017/11/14/《你不知道的JavaScript-上》行为委托/index.html">
<meta property="og:site_name" content="博言">
<meta property="og:description" content="行为委托设计模式的基础是JS中[[Prototype]]机制的本质是对象之间的关联关系。">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://img.aisss.top/17-11-11/36434319.jpg">
<meta property="og:image" content="http://img.aisss.top/17-11-11/96514462.jpg">
<meta property="og:image" content="http://img.aisss.top/17-11-11/48076431.jpg">
<meta property="og:updated_time" content="2021-03-30T08:51:19.105Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="《你不知道的JavaScript-上》行为委托">
<meta name="twitter:description" content="行为委托设计模式的基础是JS中[[Prototype]]机制的本质是对象之间的关联关系。">
<meta name="twitter:image" content="http://img.aisss.top/17-11-11/36434319.jpg">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2017/11/14/《你不知道的JavaScript-上》行为委托/">





  <title>《你不知道的JavaScript-上》行为委托 | 博言</title>
  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?92f54da1f7f5e55bd4b19d3111f903de";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>










</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">博言</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description">Stay hungry. Stay foolish.</h1>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/11/14/《你不知道的JavaScript-上》行为委托/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="liborn">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="博言">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">《你不知道的JavaScript-上》行为委托</h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-11-14T09:32:04+08:00">
                2017-11-14
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/读书笔记/" itemprop="url" rel="index">
                    <span itemprop="name">读书笔记</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/读书笔记/《你不知道的JavaScript-上》/" itemprop="url" rel="index">
                    <span itemprop="name">《你不知道的JavaScript-上》</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          
              <div class="post-description">
                  行为委托设计模式的基础是JS中[[Prototype]]机制的本质是对象之间的关联关系。
              </div>
          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>JavaScript中[[Prototype]]机制的本质是对象之间的关联关系。   </p>
<h2 id="面向委托的设计"><a href="#面向委托的设计" class="headerlink" title="面向委托的设计"></a>面向委托的设计</h2><p>[[Prototype]]代表的是一种不同于类的设计模式。       </p>
<h3 id="类理论"><a href="#类理论" class="headerlink" title="类理论"></a>类理论</h3><p>假设我们需要在软件中建模一些类似的任务。    </p>
<p>类的设计方法：  </p>
<ol>
<li>定义一个通用父（基）类，可以将其命名为Task，在Task类中定义所有任务都有的行为。</li>
<li>接着定义子类XYZ 和ABC ，它们都继承自Task 并且会添加一些特殊的行为来处理对应的任务。  </li>
</ol>
<p>类设计模式鼓励你在继承时使用方法重写（和多态）。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Task</span> </span>&#123; </span><br><span class="line">    id;</span><br><span class="line">    <span class="comment">// 构造函数Task()</span></span><br><span class="line">    Task(ID) &#123; id = ID; &#125;</span><br><span class="line">    outputTask() &#123; output( id ); &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">XYZ</span> <span class="title">inherits</span> <span class="title">Task</span> </span>&#123; </span><br><span class="line">    label;</span><br><span class="line">    <span class="comment">// 构造函数XYZ()</span></span><br><span class="line">    XYZ(ID,Label) &#123; <span class="keyword">super</span>( ID ); label = Label; &#125;</span><br><span class="line">    outputTask() &#123; <span class="keyword">super</span>(); output( label ); &#125; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ABC</span> <span class="title">inherits</span> <span class="title">Task</span> </span>&#123; </span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>构造完成后，通常只需要操作这些实例（而不是类），因为每个实例都有完成任务的所有行为。    </p>
<h3 id="委托理论"><a href="#委托理论" class="headerlink" title="委托理论"></a>委托理论</h3><p>委托行为的设计方法：    </p>
<ol>
<li>你会定义一个名为Task的对象（和许多JavaScript开发者告诉你的不同，它既不是类也不是函数），它会包含所有任务都可以使用（写作使用，读作委托）的具体行为。      </li>
<li>接着，对于每个任务（“XYZ”、“ABC”）你都会定义一个对象来存储对应的数据和行为。你会把特定的任务对象都关联到Task 功能对象上，让它们在需要的时候可以进行委托。<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">Task=&#123;</span><br><span class="line">    setID:<span class="function"><span class="keyword">function</span>(<span class="params">ID</span>)</span>&#123;<span class="keyword">this</span>.id=ID&#125;,</span><br><span class="line">    outputID:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;<span class="built_in">console</span>.log(<span class="keyword">this</span>.id);&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//让XYZ委托Task</span></span><br><span class="line">XYZ=<span class="built_in">Object</span>.create(Task);</span><br><span class="line"></span><br><span class="line">XYZ.prepareTask=<span class="function"><span class="keyword">function</span>(<span class="params">ID,Label</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.setID(ID);</span><br><span class="line">    <span class="keyword">this</span>.label=Label;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">XYZ.outputTaskDetails=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.outputID();</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.label);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<p><em>这种编码风格可以被称为“对象关联”。</em>    </p>
<p>对象关联风格的代码还有一些不同之处：    </p>
<ol>
<li>通常来说，在[[Prototype]] 委托中最好把状态保存在委托者（XYZ、ABC）而不是委托目标（Task ）上。</li>
<li>在类设计模式中，我们故意让父类（Task）和子类（XYZ）中都有outputTask方法，这样就可以利用重写（多态）的优势。在委托行为中则恰好相反：我们会尽量避免在[[Prototype]]链的不同级别中使用相同的命名，否则就需要使用笨拙并且脆弱的语法来消除引用歧义（就是显示伪多态）。</li>
<li>委托行为 意味着某些对象（XYZ）在找不到属性或者方法引用时会把这个请求委托给另一个对象（Task ）。 </li>
</ol>
<h4 id="1-互相委托（禁止）"><a href="#1-互相委托（禁止）" class="headerlink" title="1.互相委托（禁止）"></a>1.互相委托（禁止）</h4><p>无法在两个或两个以上互相（双向）委托的对象之间创建循环委托。</p>
<h4 id="2-调试"><a href="#2-调试" class="headerlink" title="2.调试"></a>2.调试</h4><p>详情见书本P168</p>
<h3 id="比较思维模型"><a href="#比较思维模型" class="headerlink" title="比较思维模型"></a>比较思维模型</h3><p>通过代码来比较两种设计模式（类和行为委托）具体的实现方法。<br>下面是典型的（“原型”）面向类风格——也就是高程里的组合继承：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Foo</span>(<span class="params">who</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.me=who;</span><br><span class="line">&#125;</span><br><span class="line">Foo.prototype.identify=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'I am'</span>+<span class="keyword">this</span>.me;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Bar</span>(<span class="params">who</span>)</span>&#123;</span><br><span class="line">    Foo.call(<span class="keyword">this</span>,who);</span><br><span class="line">&#125;</span><br><span class="line">Bar.prototype=<span class="built_in">Object</span>.create(Foo.prototype);</span><br><span class="line">Bar.prototype.speak=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    alert(<span class="string">'Helo,'</span>+<span class="keyword">this</span>.identify()+<span class="string">'.'</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> b1=<span class="keyword">new</span> Bar(<span class="string">'b1'</span>);</span><br><span class="line"><span class="keyword">var</span> b2=<span class="keyword">new</span> Bar(<span class="string">'b2'</span>);</span><br><span class="line"></span><br><span class="line">b1.speak();</span><br><span class="line">b2.speak();</span><br></pre></td></tr></table></figure>

<p>子类Bar 继承了父类Foo ，然后生成了b1和b2两个实例。b1委托了<code>Bar.prototype</code>，<code>Bar.prototype</code>委托了<code>Foo.prototype</code>。</p>
<p>下面是对象关联风格的代码： </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">Foo=&#123;</span><br><span class="line">    init:<span class="function"><span class="keyword">function</span>(<span class="params">who</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.me=who;</span><br><span class="line">    &#125;,</span><br><span class="line">    identify:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'I am'</span>+<span class="keyword">this</span>.me;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Bar=<span class="built_in">Object</span>.create(Foo);</span><br><span class="line">Bar.speak=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    alert(<span class="string">'Helo,'</span>+<span class="keyword">this</span>.identify()+<span class="string">'.'</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> b1=<span class="built_in">Object</span>.create(Bar);</span><br><span class="line">b1.init(<span class="string">'b1'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> b2=<span class="built_in">Object</span>.create(Bar);</span><br><span class="line">b2.init(<span class="string">'b2'</span>);</span><br><span class="line"></span><br><span class="line">b1.speak();</span><br><span class="line">b2.speak();</span><br></pre></td></tr></table></figure>

<p>这段代码同样完成任务且简洁了许多，我们只是把对象关联起来，并不需要那些既复杂又令人困惑的模仿类的行为（构造函数、原型以及new ）。        </p>
<p>下面看看两段代码对应的思维模型：    </p>
<ol>
<li>类风格代码的思维模型强调实体以及实体间的体系：<br><img src="http://img.aisss.top/17-11-11/36434319.jpg" alt>     </li>
</ol>
<p>这张图不够清晰，且其中有些小BUG，误导人。<br>下面看看简化版————只展示必要的对象和关系：<br><img src="http://img.aisss.top/17-11-11/96514462.jpg" alt><br>上图中虚线可有可无，反正可以通过原型链找到Foo()函数。       </p>
<ol start="2">
<li>再看看对象关联风格的代码思维模型：<br><img src="http://img.aisss.top/17-11-11/48076431.jpg" alt><br>对象关联风格的代码更加简洁，只关注一件事：<strong>对象之间的关联关系</strong>。  </li>
</ol>
<h2 id="类与对象"><a href="#类与对象" class="headerlink" title="类与对象"></a>类与对象</h2><p>现在看看在真实场景中如何应用“类”和“行为委托”两种设计模式。      </p>
<p>首先看Web中非常典型的一种前端场景：创建UI控件（按钮、下拉表单···）。    </p>
<h3 id="控件“类”"><a href="#控件“类”" class="headerlink" title="控件“类”"></a>控件“类”</h3><p>在面向对象设计模式里，一般会有一个包含所有通用控件行为的父类（可能叫做widget）和继承父类的特殊控件子类（可能叫button）</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//父类</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Widget</span>(<span class="params">width,height</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.width=width||<span class="number">50</span>;</span><br><span class="line">    <span class="keyword">this</span>.height=height||<span class="number">50</span>;</span><br><span class="line">    <span class="keyword">this</span>.$elem=<span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Widget.prototype.render=<span class="function"><span class="keyword">function</span>(<span class="params">$where</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">this</span>.$elem)&#123;</span><br><span class="line">        <span class="keyword">this</span>.$elem.css(&#123;</span><br><span class="line">            width:<span class="keyword">this</span>.width+<span class="string">"px"</span>,</span><br><span class="line">            height:<span class="keyword">this</span>.height+<span class="string">"px"</span></span><br><span class="line">        &#125;).appendTo($where);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//子类</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Button</span>(<span class="params">width,height,label</span>)</span>&#123;</span><br><span class="line">    Widget.call(<span class="keyword">this</span>,width,height);        <span class="comment">//显示伪多态</span></span><br><span class="line">    <span class="keyword">this</span>.label=label||<span class="string">"Default"</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">this</span>.$elem=$(<span class="string">"&lt;button&gt;"</span>).text(<span class="keyword">this</span>.label);</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="comment">//让Button“继承”Widget</span></span><br><span class="line">Button.prototype=<span class="built_in">Object</span>.create(Widget.prototype);</span><br><span class="line"></span><br><span class="line"><span class="comment">//重写render(..)</span></span><br><span class="line">Button.prototype.render=<span class="function"><span class="keyword">function</span>(<span class="params">$where</span>)</span>&#123;</span><br><span class="line">    <span class="comment">//"super"调用</span></span><br><span class="line">    Widget.prototype.render.call(<span class="keyword">this</span>,$where);   <span class="comment">//显示伪多态</span></span><br><span class="line">    <span class="keyword">this</span>.$elem.click(<span class="keyword">this</span>.onClick.bind(<span class="keyword">this</span>));</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Button.prototype.onClick=<span class="function"><span class="keyword">function</span>(<span class="params">evt</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"Button'"</span>+<span class="keyword">this</span>.label+<span class="string">"'clicked!"</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">$(<span class="built_in">document</span>).ready(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> $body=$(<span class="built_in">document</span>.body);</span><br><span class="line">    <span class="keyword">var</span> btn1=<span class="keyword">new</span> Button(<span class="number">125</span>,<span class="number">30</span>,<span class="string">"Hello"</span>);</span><br><span class="line">    <span class="keyword">var</span> btn2=<span class="keyword">new</span> Button(<span class="number">125</span>,<span class="number">40</span>,<span class="string">"World"</span>);</span><br><span class="line">    </span><br><span class="line">    btn1.render($body);</span><br><span class="line">    btn2.render($body);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>子类中重写的<code>render(..)</code>不会替换父类中基础的<code>render(..)</code>，只是添加一些按钮特有行为。    </p>
<p>代码中也出现了显式伪多态。呸！  </p>
<h4 id="ES6的class语法糖"><a href="#ES6的class语法糖" class="headerlink" title="ES6的class语法糖"></a>ES6的class语法糖</h4><p>简单介绍如何使用class来实现相同功能：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Widget</span></span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(width,height)&#123;</span><br><span class="line">        <span class="keyword">this</span>.width=width||<span class="number">50</span>;</span><br><span class="line">        <span class="keyword">this</span>.height=height||<span class="number">50</span>;</span><br><span class="line">        <span class="keyword">this</span>.$elem=<span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    render($where)&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">this</span>.$elem)&#123;</span><br><span class="line">            <span class="keyword">this</span>.$elem.css(&#123;</span><br><span class="line">                width:<span class="keyword">this</span>.width+<span class="string">"px"</span>,</span><br><span class="line">                height:<span class="keyword">this</span>.height+<span class="string">"px"</span></span><br><span class="line">            &#125;).appendTo($where);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Button</span> <span class="keyword">extends</span> <span class="title">Widget</span></span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(width,height,label)&#123;</span><br><span class="line">        <span class="keyword">super</span>(width,height);</span><br><span class="line">        <span class="keyword">this</span>.label=label||<span class="string">"Default"</span>;</span><br><span class="line">        <span class="keyword">this</span>.$elem=$(<span class="string">"&lt;button&gt;"</span>).text(<span class="keyword">this</span>.label);</span><br><span class="line">    &#125;</span><br><span class="line">    render($where)&#123;</span><br><span class="line">        <span class="keyword">super</span>.render($where);</span><br><span class="line">        <span class="keyword">this</span>.$elem.click(<span class="keyword">this</span>.onClick.bind(<span class="keyword">this</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    onClick(evt)&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"Button'"</span>+<span class="keyword">this</span>.label+<span class="string">"'clicked!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$(<span class="built_in">document</span>).ready(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> $body=$(<span class="built_in">document</span>.body);</span><br><span class="line">    <span class="keyword">var</span> btn1=<span class="keyword">new</span> Button(<span class="number">125</span>,<span class="number">30</span>,<span class="string">"Hello"</span>);</span><br><span class="line">    <span class="keyword">var</span> btn2=<span class="keyword">new</span> Button(<span class="number">125</span>,<span class="number">40</span>,<span class="string">"World"</span>);</span><br><span class="line">    </span><br><span class="line">    btn1.render($body);</span><br><span class="line">    btn2.render($body);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>使用ES6中<code>class</code>后，显示伪多态子类丑陋的语法不见了，但实际上这里并没有真正的类，<code>class</code>仍然是通过[[prototype]]机制实现的。<br>关于class详细的介绍在附录A。        </p>
<h3 id="委托控件对象"><a href="#委托控件对象" class="headerlink" title="委托控件对象"></a>委托控件对象</h3><p>下面使用对象关联风格委托来实现更简单的Widget/Button：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Widget=&#123;</span><br><span class="line">    init:<span class="function"><span class="keyword">function</span>(<span class="params">width,height</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.width=width||<span class="number">50</span>;</span><br><span class="line">        <span class="keyword">this</span>.height=height||<span class="number">50</span>;</span><br><span class="line">        <span class="keyword">this</span>.$elem=<span class="literal">null</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    insert:<span class="function"><span class="keyword">function</span>(<span class="params">$where</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">this</span>.$elem)&#123;</span><br><span class="line">            <span class="keyword">this</span>.$elem.css(&#123;</span><br><span class="line">                width:<span class="keyword">this</span>.width+<span class="string">"px"</span>,</span><br><span class="line">                height:<span class="keyword">this</span>.height+<span class="string">"px"</span></span><br><span class="line">            &#125;).appendTo($where);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> Button=<span class="built_in">Object</span>.create(Widget);</span><br><span class="line"></span><br><span class="line">Button.setup=<span class="function"><span class="keyword">function</span>(<span class="params">width,height,label</span>)</span>&#123;</span><br><span class="line">    <span class="comment">//委托调用</span></span><br><span class="line">    <span class="keyword">this</span>.init(width,height);</span><br><span class="line">    <span class="keyword">this</span>.label=label||<span class="string">"Default"</span>;</span><br><span class="line">    <span class="keyword">this</span>.$elem=$(<span class="string">"&lt;button&gt;"</span>).text(<span class="keyword">this</span>.label);</span><br><span class="line">&#125;;</span><br><span class="line">Button.build=<span class="function"><span class="keyword">function</span>(<span class="params">$where</span>)</span>&#123;</span><br><span class="line">    <span class="comment">//委托调用</span></span><br><span class="line">    init.insert($where);</span><br><span class="line">    <span class="keyword">this</span>.$elem.click(<span class="keyword">this</span>.onClick.bind(<span class="keyword">this</span>));</span><br><span class="line">&#125;;</span><br><span class="line">Button.onClick=<span class="function"><span class="keyword">function</span>(<span class="params">evt</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"Button'"</span>+<span class="keyword">this</span>.label+<span class="string">"'clicked!"</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">$(<span class="built_in">document</span>).ready(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> $body=$(<span class="built_in">document</span>.body);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> btn1=<span class="built_in">Object</span>.create(Button);</span><br><span class="line">    btn1.setup(<span class="number">125</span>,<span class="number">30</span>,<span class="string">"Hello"</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> btn2=<span class="built_in">Object</span>.create(Button);</span><br><span class="line">    btn2.setup(<span class="number">150</span>,<span class="number">40</span>,<span class="string">"world"</span>);</span><br><span class="line">    </span><br><span class="line">    btn1.build($body);</span><br><span class="line">    btn2.build($body);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>委托设计模式，能够使用不相同且更具描述性的方法，还能避免使用丑陋的显式伪多态，代之使用委托调用。    </p>
<p>之前的一次调用（<code>var btn1=new Button(..)</code>）现在变成了两次（<code>var btn1=Object.create(Button);btn1.setup(..)</code>），代码变多了一点，但是这样能更好关注分离原则，创建和初始化并不需要合并为一个步骤。  </p>
<h2 id="更简洁的设计"><a href="#更简洁的设计" class="headerlink" title="更简洁的设计"></a>更简洁的设计</h2><p>对象关联除了能让代码看起来更简洁并且更具扩展性外，还能通过行为委托模式简化代码结构。下面看一个例子，对象关联如何简化整体设计。      </p>
<p>这个场景中我们有两个控制器对象，一个用来操作网页中的登录表单，另一个用来与服务器进行验证（通信）。我们使用jQuery创建Ajax通信。      </p>
<p>在传统的类设计模式中，我们会把基础函数定义在名为Controller的类中，然后派生两个子类LoginController和AuthController，他们都继承自Controller并且重写了一些基础行为：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//父类</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Controller</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.errors=[];</span><br><span class="line">&#125;</span><br><span class="line">Controller.prototype.showDialog=<span class="function"><span class="keyword">function</span>(<span class="params">title,msg</span>)</span>&#123;</span><br><span class="line">    <span class="comment">//给用户显示标题和消息</span></span><br><span class="line">&#125;;</span><br><span class="line">Controller.prototype.success=<span class="function"><span class="keyword">function</span>(<span class="params">msg</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.showDialog(<span class="string">"Success"</span>,msg);</span><br><span class="line">&#125;;</span><br><span class="line">Controller.prototype.failure=<span class="function"><span class="keyword">function</span>(<span class="params">err</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.errors.push(err);</span><br><span class="line">    <span class="keyword">this</span>.showDialog(<span class="string">"Error"</span>,err);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//子类</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">LoginController</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    Controller.call(<span class="keyword">this</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//把子类关联到父类</span></span><br><span class="line">LoginController.prototype=<span class="built_in">Object</span>.create(Controller.prototype);</span><br><span class="line">LoginController.prototype.getUser=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">document</span>.getElementById(<span class="string">"login_username"</span>).value;</span><br><span class="line">&#125;;</span><br><span class="line">LoginController.prototype.getPassword=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">document</span>.getElementById(<span class="string">"login_password"</span>).value;</span><br><span class="line">&#125;;</span><br><span class="line">LoginController.prototype.validateEntry=<span class="function"><span class="keyword">function</span>(<span class="params">user,pw</span>)</span>&#123;</span><br><span class="line">    user=user||<span class="keyword">this</span>.getUser();</span><br><span class="line">    pw=pw||<span class="keyword">this</span>.getPassword();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>(!(ueser&amp;&amp;pw))&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.failure(<span class="string">"Please enter a username &amp; password!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(pw.length&lt;<span class="number">5</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.failure(<span class="string">"Password must be 5+ characters!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//如果执行到这里说明通过验证</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//重写基础的failure()</span></span><br><span class="line">LoginController.prototype.failure=<span class="function"><span class="keyword">function</span>(<span class="params">err</span>)</span>&#123;</span><br><span class="line">    <span class="comment">//“super”调用</span></span><br><span class="line">    Controller.prototype.failure.call(<span class="keyword">this</span>,<span class="string">"Login invaild: "</span>+err);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//子类</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">AuthController</span>(<span class="params">login</span>)</span>&#123;</span><br><span class="line">    Controller.call(<span class="keyword">this</span>);</span><br><span class="line">    <span class="comment">//合成</span></span><br><span class="line">    <span class="keyword">this</span>.login=login;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//把子类关联到父类</span></span><br><span class="line">AuthController.prototype=<span class="built_in">Object</span>.create(Controller.prototype);</span><br><span class="line">AuthController.prototype.server=<span class="function"><span class="keyword">function</span>(<span class="params">url,data</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> $.ajax(&#123;</span><br><span class="line">        url:url,</span><br><span class="line">        data:data</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br><span class="line">AuthController.prototype.checkAuth=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> user=<span class="keyword">this</span>.login.getUser();</span><br><span class="line">    <span class="keyword">var</span> pw=<span class="keyword">this</span>.login.getPassword();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">this</span>.login.validateEntry(user,pw))&#123;</span><br><span class="line">        <span class="keyword">this</span>.server(<span class="string">"/check-auth"</span>,&#123;</span><br><span class="line">            user:user,</span><br><span class="line">            pw:pw</span><br><span class="line">        &#125;).then(<span class="keyword">this</span>.success.bind(<span class="keyword">this</span>)).fail(<span class="keyword">this</span>.failure.bind(<span class="keyword">this</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//重写基础的success()</span></span><br><span class="line">AuthController.prototype.success=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="comment">//"super"调用</span></span><br><span class="line">    Controller.prototype.success.call(<span class="keyword">this</span>,<span class="string">"Authentitcated"</span>);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//重写基础的failure()</span></span><br><span class="line">AuthController.prototype.failure=<span class="function"><span class="keyword">function</span>(<span class="params">err</span>)</span>&#123;</span><br><span class="line">    <span class="comment">//"super"调用</span></span><br><span class="line">    Controller.prototype.failure.call(<span class="keyword">this</span>,<span class="string">"Auth Failed: "</span>+err);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> auth=<span class="keyword">new</span> AuthController(</span><br><span class="line">    <span class="comment">//除了继承，我们还需要合成</span></span><br><span class="line">    <span class="keyword">new</span> LoginController()</span><br><span class="line">);</span><br><span class="line">auth.checkAuth();</span><br></pre></td></tr></table></figure>

<p>所有控制器共享的基础行为是<code>success(..)</code>、<code>failure(..)</code>和<code>showDialog(..)</code>。子类LoginController和AuthController 通过重写<code>failure(..)</code> 和<code>success(..)</code> 来扩展默认基础类行为。      </p>
<p>另一个需要注意的是我们在继承的基础上进行了一些合成。AuthController需要使用LoginController ，因此我们实例化后者（<code>new LoginController()</code>）并用一个类成员属性<code>this.login</code>来引用它，这样AuthController 就可以调<br>用LoginController 的行为。</p>
<h3 id="反类"><a href="#反类" class="headerlink" title="反类"></a>反类</h3><p>我们真的需要一个controller父类、两个子类加上合成来对这个问题进行建模吗？<br>该对象关联的行为委托设计模式登场了</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> LoginController=&#123;</span><br><span class="line">    errors:[],</span><br><span class="line">    getUser:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">document</span>.getElementById(<span class="string">"login_username"</span>).value;</span><br><span class="line">    &#125;,</span><br><span class="line">    getPassword:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">document</span>.getElementById(<span class="string">"login_password"</span>).value;</span><br><span class="line">    &#125;,</span><br><span class="line">    validateEntry:<span class="function"><span class="keyword">function</span>(<span class="params">user,pw</span>)</span>&#123;</span><br><span class="line">        user=user||<span class="keyword">this</span>.getUser();</span><br><span class="line">        pw=pw||<span class="keyword">this</span>.getPassword;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span>(!(ueser&amp;&amp;pw))&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.failure(<span class="string">"Please enter a username &amp; password!"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(pw.length&lt;<span class="number">5</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.failure(<span class="string">"Password must be 5+ characters!"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">        <span class="comment">//如果执行到这里说明通过验证</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    showDialog:<span class="function"><span class="keyword">function</span>(<span class="params">title,msg</span>)</span>&#123;</span><br><span class="line">        <span class="comment">//给用户显示标题和消息</span></span><br><span class="line">    &#125;,</span><br><span class="line">    failure:<span class="function"><span class="keyword">function</span>(<span class="params">err</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.errors.push(err);</span><br><span class="line">        <span class="keyword">this</span>.showDialog(<span class="string">"Error"</span>,<span class="string">"Login invaild: "</span>+err);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//让AuthController委托LoginController</span></span><br><span class="line"><span class="keyword">var</span> AuthController=<span class="built_in">Object</span>.create(LoginController);</span><br><span class="line"></span><br><span class="line">AuthController.errors=[];</span><br><span class="line">AuthController.checkAuth=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> user=<span class="keyword">this</span>.login.getUser();</span><br><span class="line">    <span class="keyword">var</span> pw=<span class="keyword">this</span>.login.getPassword();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">this</span>.login.validateEntry(user,pw))&#123;</span><br><span class="line">        <span class="keyword">this</span>.server(<span class="string">"/check-auth"</span>,&#123;</span><br><span class="line">            user:user,</span><br><span class="line">            pw:pw</span><br><span class="line">        &#125;).then(<span class="keyword">this</span>.accepted.bind(<span class="keyword">this</span>)).fail(<span class="keyword">this</span>.rejected.bind(<span class="keyword">this</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">AuthController.server=<span class="function"><span class="keyword">function</span>(<span class="params">url,data</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> $.ajax(&#123;</span><br><span class="line">        url:url,</span><br><span class="line">        data:data</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br><span class="line">AuthController.accepted=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.showDialog(<span class="string">"Success"</span>,<span class="string">"Authenticated!"</span>);</span><br><span class="line">&#125;;</span><br><span class="line">AuthController.rejected=<span class="function"><span class="keyword">function</span>(<span class="params">err</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.failure(<span class="string">"Auth Failed: "</span>+err);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">AuthController.checkAuth();</span><br></pre></td></tr></table></figure>

<p>在行为委托模式中，AuthController 和LoginController 只是对象，它们之间是<strong>兄弟关系</strong> ，并不是父类和子类的关系。代码中AuthController委托了LoginController，反向委托也完全没问题。        </p>
<p>这种模式的重点在于只需要两个实体（LoginController和AuthController），而之前的模式需要三个，省去了Controller基类来“共享”，也避免了面向类设计模式中的多态。      </p>
<p>总结：我们用一种（极其）简单的设计实现了同样的功能，这就是<strong>对象关联风格代码</strong>和<strong>行为委托设计模式</strong>的力量。    </p>
<h2 id="更好的语法"><a href="#更好的语法" class="headerlink" title="更好的语法"></a>更好的语法</h2><p><strong>1. ES6中的class</strong><br>class可以简洁定义类方法，能够不使用关键字function，如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span></span>&#123;</span><br><span class="line">    methodName()&#123;<span class="comment">/*..*/</span>&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>2. ES6中的简洁方法声明</strong><br>ES6中任意对象的字面量都能使用简洁方法声明，如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> LoginController = &#123; </span><br><span class="line">    errors: [],</span><br><span class="line">    getUser() &#123; <span class="comment">//妈妈再也不用担心代码里有function了！</span></span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;,</span><br><span class="line">    getPassword() &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><strong>3. ES6中更好的对象字面量语法</strong><br>使用对象字面量+<code>Object.setPrototypeOf(..)</code>方法，抛弃<code>Object.create(..)</code>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用更好的对象字面形式语法和简洁方法</span></span><br><span class="line"><span class="keyword">var</span> AuthController = &#123; </span><br><span class="line">    errors: [],</span><br><span class="line">    checkAuth() &#123; </span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;,</span><br><span class="line">    server(url,data) &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// 现在把AuthController关联到LoginController</span></span><br><span class="line"><span class="built_in">Object</span>.setPrototypeOf( AuthController, LoginController );</span><br></pre></td></tr></table></figure>



<h3 id="反词法"><a href="#反词法" class="headerlink" title="反词法"></a>反词法</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Foo = &#123;</span><br><span class="line">    bar() &#123; <span class="comment">/*..*/</span> &#125;,</span><br><span class="line">    baz: <span class="function"><span class="keyword">function</span> <span class="title">baz</span>(<span class="params"></span>) </span>&#123; <span class="comment">/*..*/</span> &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>去掉语法糖后：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Foo = &#123;</span><br><span class="line">    bar: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; <span class="comment">/*..*/</span> &#125;, </span><br><span class="line">    baz: <span class="function"><span class="keyword">function</span> <span class="title">baz</span>(<span class="params"></span>) </span>&#123; <span class="comment">/*..*/</span> &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>由于函数对象本身没有名称标识符，所以bar() 的缩写形式（function().. ）实际上会变成一个 匿名函数表达式 数表达式并赋值给bar属性。相比之下，具名函数表达式具名函数表达式（function baz().. ）会额外给.baz 属性附加一个<strong>词法名称标识符baz</strong> （baz只在其函数内部可见）。      </p>
<p>简洁方法有一个非常小但是非常重要的缺点——自我引用更难。<br>因为它不具备可以自我引用的词法标识符。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Foo = &#123;</span><br><span class="line">    bar: <span class="function"><span class="keyword">function</span>(<span class="params">x</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(x&lt;<span class="number">10</span>)&#123;</span><br><span class="line">           <span class="keyword">return</span> Foo.bar( x * <span class="number">2</span> );   <span class="comment">//注意这一行</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> x; </span><br><span class="line">    &#125;,</span><br><span class="line">    baz: <span class="function"><span class="keyword">function</span> <span class="title">baz</span>(<span class="params">x</span>) </span>&#123; </span><br><span class="line">        <span class="keyword">if</span>(x &lt; <span class="number">10</span>)&#123;</span><br><span class="line">           <span class="keyword">return</span> baz( x * <span class="number">2</span> );       <span class="comment">//注意这一行</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> x; </span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>在本例中使用<code>Foo.bar(x*2)</code>就足够了，但是在许多情况下无法使用这种方法，比如多个对象通过代理共享函数、使用this 绑定，等等。这种情况下最好的办法就是使用<em>函数对象的name标识符</em>来进行真正的自我引用。  </p>
<h2 id="内省"><a href="#内省" class="headerlink" title="内省"></a>内省</h2><p>自省就是检查实例的类型。        </p>
<p>类实例的自省主要目的是通过创建方式来判断对象的结构和功能。  </p>
<p><code>instanceof</code>语法会产生语义困惑而且非常不直观，不能直接判断两个对象是否关联。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Foo</span>(<span class="params"></span>) </span>&#123; <span class="comment">/* .. */</span> &#125; </span><br><span class="line">Foo.prototype...</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Bar</span>(<span class="params"></span>) </span>&#123; <span class="comment">/* .. */</span> &#125;</span><br><span class="line">Bar.prototype = <span class="built_in">Object</span>.create( Foo.prototype );</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> b1 = <span class="keyword">new</span> Bar( <span class="string">"b1"</span> );</span><br></pre></td></tr></table></figure>

<p>如果要使用instanceof和prototype语义来检查上面中实体的关系，需要这么做：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Foo和Bar互相关联</span></span><br><span class="line">Bar.prototype <span class="keyword">instanceof</span> Foo; <span class="comment">// true </span></span><br><span class="line"><span class="built_in">Object</span>.getPrototypeOf( Bar.prototype )</span><br><span class="line">   === Foo.prototype; <span class="comment">// true </span></span><br><span class="line">Foo.prototype.isPrototypeOf( Bar.prototype ); <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// b1关联到Foo和Bar</span></span><br><span class="line">b1 <span class="keyword">instanceof</span> Foo; <span class="comment">// true</span></span><br><span class="line">b1 <span class="keyword">instanceof</span> Bar; <span class="comment">// true</span></span><br><span class="line"><span class="built_in">Object</span>.getPrototypeOf( b1 ) === Bar.prototype; <span class="comment">// true </span></span><br><span class="line">Foo.prototype.isPrototypeOf( b1 ); <span class="comment">// true</span></span><br><span class="line">Bar.prototype.isPrototypeOf( b1 ); <span class="comment">// true</span></span><br></pre></td></tr></table></figure>


<p>对象关联风格代码的内省更加简洁。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Foo = &#123; <span class="comment">/* .. */</span> &#125;;</span><br><span class="line"><span class="keyword">var</span> Bar = <span class="built_in">Object</span>.create( Foo );</span><br><span class="line">Bar...</span><br><span class="line"><span class="keyword">var</span> b1 = <span class="built_in">Object</span>.create( Bar );</span><br></pre></td></tr></table></figure>

<p>使用对象关联，所有对象都是通过[[prototype]]委托互相关联的。内省方法更加简洁。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Foo和Bar互相关联</span></span><br><span class="line">Foo.isPrototypeOf( Bar ); <span class="comment">// true </span></span><br><span class="line"><span class="built_in">Object</span>.getPrototypeOf( Bar ) === Foo; <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// b1关联到Foo和Bar</span></span><br><span class="line">Foo.isPrototypeOf( b1 ); <span class="comment">// true</span></span><br><span class="line">Bar.isPrototypeOf( b1 ); <span class="comment">// true </span></span><br><span class="line"><span class="built_in">Object</span>.getPrototypeOf( b1 ) === Bar; <span class="comment">// true</span></span><br></pre></td></tr></table></figure>



<h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p>在软件架构中你可以选择是否选择是否使用类和继承设计模式。大多数开发者理所当然地认为类是唯一（合适）的代码组织方式，但是本章中我们看到了另一种更少见但是更强大的设计模式：<strong>行为委托</strong> 。         </p>
<p>行为委托认为对象之间是兄弟关系，互相委托，而不是父类和子类的关系。JavaScript的[[Prototype]] 机制本质上就是行为委托机制。也就是说，我们可以选择在JavaScript中努力实现类机制（参见第4和第5章），也可以拥抱更自然的[[Prototype]] 委托机制。        </p>
<p>当你只用对象来设计代码时，不仅可以让语法更加简洁，而且可以让代码结构更加清晰。      </p>
<p>对象关联（对象之前互相关联）是一种编码风格，它倡导的是直接创建和关联对象，不把它们抽象成类。对象关联可以用基于[[Prototype]] 的行为委托非常自然地实现。</p>

      
    </div>
    
    
    

    
      <div>
        <div id="wechat_subscriber" style="display: block; padding: 10px 0; margin: 20px auto; width: 100%; text-align: center">
    <img id="wechat_subscriber_qcode" src="/uploads/wechat-qcode.jpg" alt="liborn wechat" style="width: 200px; max-width: 100%;">
    <div>欢迎您扫一扫上面的微信二维码，订阅我的公众号！</div>
</div>

      </div>
    

    

    
      <div>
        <ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者：</strong>
    liborn
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="http://yoursite.com/2017/11/14/《你不知道的JavaScript-上》行为委托/" title="《你不知道的JavaScript-上》行为委托">http://yoursite.com/2017/11/14/《你不知道的JavaScript-上》行为委托/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>
    本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/" rel="external nofollow" target="_blank">CC BY-NC-SA 3.0</a> 许可协议。转载请注明出处！
  </li>
</ul>

      </div>
    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/JavaScript/" rel="tag"># JavaScript</a>
          
            <a href="/tags/系统学习/" rel="tag"># 系统学习</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2017/11/13/《你不知道的JavaScript-上》原型/" rel="next" title="《你不知道的JavaScript-上》原型">
                <i class="fa fa-chevron-left"></i> 《你不知道的JavaScript-上》原型
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2017/11/15/《你不知道的JavaScript-上》附录class/" rel="prev" title="《你不知道的JavaScript-上》附录class">
                《你不知道的JavaScript-上》附录class <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
        <!-- JiaThis Button BEGIN -->
<div class="jiathis_style">
  <a class="jiathis_button_tsina"></a>
  <a class="jiathis_button_tqq"></a>
  <a class="jiathis_button_weixin"></a>
  <a class="jiathis_button_cqq"></a>
  <a class="jiathis_button_douban"></a>
  <a class="jiathis_button_renren"></a>
  <a class="jiathis_button_qzone"></a>
  <a class="jiathis_button_kaixin001"></a>
  <a class="jiathis_button_copy"></a>
  <a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank"></a>
  <a class="jiathis_counter_style"></a>
</div>
<script type="text/javascript">
  var jiathis_config={
    hideMore:false
  }
</script>
<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js" charset="utf-8"></script>
<!-- JiaThis Button END -->

      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image" src="/images/avatar.jpg" alt="liborn">
          <p class="site-author-name" itemprop="name">liborn</p>
           
              <p class="site-description motion-element" itemprop="description"></p>
           
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">95</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">11</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">23</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/Rebornnn" target="_blank" title="Github">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                    
                      Github
                    
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://weibo.com/1628588307" target="_blank" title="Weibo">
                  
                    <i class="fa fa-fw fa-weibo"></i>
                  
                    
                      Weibo
                    
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://l15927137339@gmail.com" target="_blank" title="Google">
                  
                    <i class="fa fa-fw fa-google"></i>
                  
                    
                      Google
                    
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#面向委托的设计"><span class="nav-number">1.</span> <span class="nav-text">面向委托的设计</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#类理论"><span class="nav-number">1.1.</span> <span class="nav-text">类理论</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#委托理论"><span class="nav-number">1.2.</span> <span class="nav-text">委托理论</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-互相委托（禁止）"><span class="nav-number">1.2.1.</span> <span class="nav-text">1.互相委托（禁止）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-调试"><span class="nav-number">1.2.2.</span> <span class="nav-text">2.调试</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#比较思维模型"><span class="nav-number">1.3.</span> <span class="nav-text">比较思维模型</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#类与对象"><span class="nav-number">2.</span> <span class="nav-text">类与对象</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#控件“类”"><span class="nav-number">2.1.</span> <span class="nav-text">控件“类”</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#ES6的class语法糖"><span class="nav-number">2.1.1.</span> <span class="nav-text">ES6的class语法糖</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#委托控件对象"><span class="nav-number">2.2.</span> <span class="nav-text">委托控件对象</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#更简洁的设计"><span class="nav-number">3.</span> <span class="nav-text">更简洁的设计</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#反类"><span class="nav-number">3.1.</span> <span class="nav-text">反类</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#更好的语法"><span class="nav-number">4.</span> <span class="nav-text">更好的语法</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#反词法"><span class="nav-number">4.1.</span> <span class="nav-text">反词法</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#内省"><span class="nav-number">5.</span> <span class="nav-text">内省</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#小结"><span class="nav-number">6.</span> <span class="nav-text">小结</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">
  
  &copy;  2017 - 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">liborn</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>

  
  <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.2"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.2"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.2"></script>



  


  




	





  





  






  





  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  

  

  

  

</body>
</html>
