---
title: 《深入浅出node.js》读书笔记4-1内存控制
date: 2019-08-21 16:52:49
categories:
- 读书笔记
- 《深入浅出node.js》
tags:
- node
- 系统学习
description: 内存控制
---

## V8的垃圾回收机制与内存限制
在Node中，内存管理的好坏、垃圾回收状况是否优良都与JavaScript执行引擎V8息息相关。    

### V8的内存限制
Node在通过Javascript使用内存时只能使用部分内存（64位系统下约为1.4GB，32位系统下约为0.7GB）。

### V8的对象分配
在V8中，所有的Javascript对象都是通过堆来进行分配的
- Node在启动时可以传递参数来调整内存限制的大小
```
node --max-old-space-size=1700 test.js //单位为MB
node --max-new-space-size=1024 test.js // 单位为KB
```

### V8的垃圾回收机制
1. V8主要的垃圾回收算法
V8的垃圾回收策略主要基于分代式垃圾回收机制。
- 新生代中的对象主要通过Scaverge算法进行回收
- 老生代中的对象采用Mark-Sweep和Mark-Compact相结合方式进行垃圾回收

### 查看垃圾回收日志
- 查看垃圾回收的主要方式是在启动时添加`--trace_gc`参数。      
- 在启动时使用`--prof`参数，可以得到V8执行时的性能分析数据。  

## 高效使用内存
V8面前，开发者所要具备的责任是如何让垃圾回收机制更高效地工作。

### 作用域
在Javascript中能形成作用域的有
- 函数调用
- with
- 全局作用域

### 闭包
在正常Javascript执行中，无法立即回收的内存有闭包和全局变量引用。需要小心使用。

## 内存指标
### 查看内存使用情况
1. 查看进程的内存占用

