---
title: 《深入浅出node.js》读书笔记6-1网络编程
date: 2019-08-23 23:57:27
categories:
- 读书笔记
- 《深入浅出node.js》
tags:
- node
- 系统学习
description: Buffer
---
Node是一个面向网络而生的平台，它具有事件驱动、无阻塞、单线程等特性，具备良好的可伸缩性，使它十分轻量，适合在分布式网络中扮演各种各样的角色。        
Node只需几行代码即可构建服务器，无需额外的容器。        
Node提供net、dgram、http、https4个模块，分别用于TCP、UDP、HTTP、HTTPS。适用于服务器和客户端。

## 构建TCP服务
TCP服务在网络应用中十分常见，目前大多数的应用都是基于TCP搭建而成。

### TCP
TCP全名为传输控制协议，在OSI模型中属于传输层协议。TCP协议是面向连接的协议，其显著的特征是在传输之前需要3次握手形成会话。只有形成会话之后，服务器端和客户端之间才能互相发送数据。        
![](http://img.aisss.top/FkDDxpAyose34YtA1Irp_19zri8A)

### 创建TCP服务器端
创建一个TCP服务端来接受网络请求
```JavaScript
var net = require('net');

var server = net.createServer(function(socket){
    // 新的连接
    socket.on('data', function(data){
        socket.write('你好')
    })

    socket.on('end', function() {
        console.log('连接断开')
    })
    socket.write("欢迎光临《深入浅出node.js》示例：\n"); 
})

server.listen(8124, function(){
    console.log('server bound');
})
```
通过net模块自行构建客户端进行会话，测试上面构建的TCP服务的代码，如下：
```Javascript
var net = require('net');
var client = net.connect({port: 8124}, function(){
    console.log('client connected');
    client.write('world!\r\n');
})

client.on('data', function(data){
    console.log(data.toString());
    client.end();
})

client.on('end', function(){
    console.log('client disconnected');
})
```

### TCP服务的事件
#### 1. 服务器事件   
对于通过`net.createServer()`创建的服务器而言，它是一个EventEmitter实例，它的自定义事件有如下几种：
- listening: 在调用`server.listen()`绑定端口或者Domain Socket后触发。
- connection: 每个客户端套接字连接到服务器时触发，简洁写法为通过`net.createServer()`的最后一个参数传递。
- close： 当服务器关闭时触发，在调用`server.close()`后，服务器将停止接受新的套接字连接，但保持当前存在但连接，等待所有连接都断开后，会触发该事件。
- error: 当服务器发送异常时，将会触发该事件。比如侦听一个使用中的端口，将会触发一个异常，如果不侦听error事件，服务器将会抛出异常。

#### 2. 连接事件

